<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≤„Éº„É† Èü≥„ÅÇ„ÇäÂÆåÂÖ®Áâà</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    #startScreen {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    #gameCanvas {
      display: none;
      background-color: black;
    }
    #backButton, #scoreDisplay, #timerDisplay, #lifeDisplay {
      position: absolute;
      padding: 10px 20px;
      background-color: #fff;
      color: #000;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      z-index: 10;
      user-select: none;
    }
    #backButton { top: 20px; left: 20px; cursor: pointer; }
    #scoreDisplay { top: 20px; right: 250px; }
    #lifeDisplay { top: 20px; right: 150px; }
    #timerDisplay { top: 20px; right: 20px; }
    #gameMessage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 36px;
      background: rgba(0,0,0,0.7);
      padding: 20px 40px;
      border-radius: 10px;
      display: none;
      z-index: 10;
      user-select: none;
    }
    .mobile-controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 11;
    }
    .mobile-btn {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.7);
      border-radius: 50%;
      text-align: center;
      line-height: 60px;
      font-size: 24px;
      user-select: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="startScreen">
  <h1>„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≤„Éº„É†</h1>
  <button id="startBtn" style="font-size:24px; padding:10px 30px; cursor:pointer;">„Ç≤„Éº„É†ÈñãÂßã</button>
</div>

<button id="backButton" onclick="location.href='index.html'" style="display:none;">Êàª„Çã</button>
<div id="scoreDisplay" style="display:none;">„Çπ„Ç≥„Ç¢: 0</div>
<div id="lifeDisplay" style="display:none;">„É©„Ç§„Éï: 5</div>
<div id="timerDisplay" style="display:none;">ÊôÇÈñì: 60</div>
<div id="gameMessage"></div>
<canvas id="gameCanvas"></canvas>
<div class="mobile-controls" style="display:none;">
  <div class="mobile-btn" id="leftBtn">‚óÄ</div>
  <div class="mobile-btn" id="shootBtn">‚óè</div>
  <div class="mobile-btn" id="rightBtn">‚ñ∂</div>
</div>

<!-- „Åì„Åì„ÅØÂøÖ„Åö„É™„Éù„Ç∏„Éà„É™ÂÜÖ audio „Éï„Ç©„É´„ÉÄ„Å´„Éï„Ç°„Ç§„É´„ÇíÁΩÆ„Åè„Åì„Å® -->
<audio id="bgm" src="audio/arcade-loop.mp3" loop preload="auto"></audio>
<audio id="shootSound" src="audio/laser-shoot.mp3" preload="auto"></audio>
<audio id="explodeSound" src="audio/explosion.mp3" preload="auto"></audio>

<script>
  const startBtn = document.getElementById("startBtn");
  const startScreen = document.getElementById("startScreen");
  const backButton = document.getElementById("backButton");
  const scoreDisplay = document.getElementById("scoreDisplay");
  const lifeDisplay = document.getElementById("lifeDisplay");
  const timerDisplay = document.getElementById("timerDisplay");
  const gameMessage = document.getElementById("gameMessage");
  const gameCanvas = document.getElementById("gameCanvas");
  const mobileControls = document.querySelector(".mobile-controls");

  const bgm = document.getElementById("bgm");
  const shootSound = document.getElementById("shootSound");
  const explodeSound = document.getElementById("explodeSound");

  const ctx = gameCanvas.getContext("2d");

  let player, bullets, enemies, explosions;
  let score, gameOver, timeLeft;
  const clearScore = 900;

  function initGame() {
    gameCanvas.width = window.innerWidth;
    gameCanvas.height = window.innerHeight;

    player = {
      x: gameCanvas.width / 2,
      y: gameCanvas.height - 60,
      width: 40,
      height: 40,
      color: "lime",
      speed: 10,
      life: 5
    };

    bullets = [];
    enemies = [];
    explosions = [];

    score = 0;
    gameOver = false;
    timeLeft = 60;

    updateDisplays();
  }

  function updateDisplays() {
    scoreDisplay.textContent = `„Çπ„Ç≥„Ç¢: ${score}`;
    timerDisplay.textContent = `ÊôÇÈñì: ${timeLeft}`;
    lifeDisplay.textContent = `„É©„Ç§„Éï: ${player.life}`;
  }

  function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
  }

  function drawBullets() {
    ctx.fillStyle = "yellow";
    for (let i = bullets.length - 1; i >= 0; i--) {
      bullets[i].y -= 10;
      ctx.fillRect(bullets[i].x, bullets[i].y, 5, 20);
      if (bullets[i].y < 0) bullets.splice(i, 1);
    }
  }

  const enemyTypes = [
    { color: "red", score: 10, hp: 1, damage: 1, chance: 0.6 },
    { color: "blue", score: 30, hp: 4, damage: 2, chance: 0.3 },
    { color: "gold", score: 80, hp: 10, damage: 99, chance: 0.1 }
  ];

  function drawEnemies() {
    for (let i = enemies.length - 1; i >= 0; i--) {
      const enemy = enemies[i];
      enemy.y += 2;
      ctx.fillStyle = enemy.color;
      ctx.fillRect(enemy.x, enemy.y, 40, 40);

      // Âºæ„Å®„ÅÆÂΩì„Åü„ÇäÂà§ÂÆö
      for (let j = bullets.length - 1; j >= 0; j--) {
        const bullet = bullets[j];
        if (
          bullet.x < enemy.x + 40 && bullet.x + 5 > enemy.x &&
          bullet.y < enemy.y + 40 && bullet.y + 20 > enemy.y
        ) {
          bullets.splice(j, 1);
          enemy.hp--;
          if (enemy.hp <= 0) {
            score += enemy.score;
            explodeSound.currentTime = 0;
            explodeSound.play();
            explosions.push({ x: enemy.x, y: enemy.y, radius: 0 });
            enemies.splice(i, 1);
            break;
          }
        }
      }

      // „Éó„É¨„Ç§„É§„Éº„Å®„ÅÆÂΩì„Åü„ÇäÂà§ÂÆö
      if (
        enemy.y + 40 > player.y &&
        enemy.x < player.x + player.width &&
        enemy.x + 40 > player.x
      ) {
        player.life -= enemy.damage;
        enemies.splice(i, 1);
        if (player.life <= 0) {
          endGame(false);
          return;
        }
      }

      // „Éó„É¨„Ç§„É§„Éº„Çà„ÇäYÂ∫ßÊ®ô„ÅåÂ§ß„Åç„Åè„Å™„Å£„Åü„ÇâÊ∂à„Åô
      if (enemy.y > player.y + player.height) {
        enemies.splice(i, 1);
      }
    }
  }

  function drawExplosions() {
    for (let i = explosions.length - 1; i >= 0; i--) {
      const exp = explosions[i];
      ctx.beginPath();
      ctx.arc(exp.x + 20, exp.y + 20, exp.radius, 0, Math.PI * 2);
      ctx.fillStyle = "orange";
      ctx.fill();
      exp.radius += 3;
      if (exp.radius > 30) explosions.splice(i, 1);
    }
  }

  function spawnEnemy() {
    if (gameOver) return;
    const rand = Math.random();
    let total = 0;
    for (const type of enemyTypes) {
      total += type.chance;
      if (rand <= total) {
        enemies.push({
          x: Math.random() * (gameCanvas.width - 40),
          y: -40,
          color: type.color,
          score: type.score,
          hp: type.hp,
          damage: type.damage
        });
        break;
      }
    }
  }

  function endGame(clear) {
    gameOver = true;
    const msg = clear ? `üéâ„Ç≤„Éº„É†„ÇØ„É™„Ç¢ÔºÅ„Çπ„Ç≥„Ç¢: ${score}` : `‚ùå„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº... „Çπ„Ç≥„Ç¢: ${score}`;
    gameMessage.textContent = msg;
    gameMessage.style.display = "block";
    bgm.pause();
    bgm.currentTime = 0;
  }

  function checkTime() {
    timeLeft--;
    if (timeLeft <= 0) {
      endGame(score >= clearScore);
    }
  }

  function gameLoop() {
    if (gameOver) return;
    ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
    drawPlayer();
    drawBullets();
    drawEnemies();
    drawExplosions();
    updateDisplays();
    requestAnimationFrame(gameLoop);
  }

  function shootBullet() {
    bullets.push({ x: player.x + player.width / 2 - 2.5, y: player.y });
    shootSound.currentTime = 0;
    shootSound.play();
  }

  document.addEventListener("keydown", e => {
    if (e.key === "ArrowLeft" && player.x > 0) player.x -= player.speed;
    if (e.key === "ArrowRight" && player.x < gameCanvas.width - player.width) player.x += player.speed;
    if (e.key === " ") shootBullet();
  });

  document.getElementById("leftBtn").addEventListener("touchstart", () => player.x -= player.speed);
  document.getElementById("rightBtn").addEventListener("touchstart", () => player.x += player.speed);
  document.getElementById("shootBtn").addEventListener("touchstart", shootBullet);

  startBtn.addEventListener("click", () => {
    startScreen.style.display = "none";
    gameCanvas.style.display = "block";
    backButton.style.display = "block";
    scoreDisplay.style.display = "block";
    lifeDisplay.style.display = "block";
    timerDisplay.style.display = "block";
    mobileControls.style.display = "flex";

    initGame();
    bgm.play().catch(() => {/* Ëá™ÂãïÂÜçÁîüÂà∂Èôê„Åß„Ç®„É©„Éº„Å™„ÇâÁÑ°Ë¶ñ */});
    setInterval(spawnEnemy, 1000);
    setInterval(() => { if (!gameOver) checkTime(); }, 1000);
    gameLoop();
  });
</script>

</body>
</html>
